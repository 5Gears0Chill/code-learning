# Entity Frame Core 

The following documentation highlights personal best found practices when working with EF Core.

## Database First Implementation

Once the necessary packages have been installed the following command can be run in the `NuGet Package Manager Console` 

```shell
 Scaffold-DbContext [-Connection] <String> [-Provider] <String> [-OutputDir <String>] [-ContextDir <String>] [-Context <String>] [-Schemas <String[]>] [-Tables <String[]>] [-DataAnnotations] 
    [-UseDatabaseNames] [-Force] [-Project <String>] [-StartupProject <String>] [<CommonParameters>]
```

Running the `get-help Scaffold-DbContext -detailed` Produces a detailed description of each parameter. This allows for customizations in the `DbContext` That is produced upon completion.
```
DESCRIPTION
    Scaffolds a DbContext and entity types for a database.
    
PARAMETERS
    -Connection <String>
        The connection string to the database.
        
    -Provider <String>
        The provider to use. (E.g. Microsoft.EntityFrameworkCore.SqlServer)
        
    -OutputDir <String>
        The directory to put files in. Paths are relative to the project directory.
        
    -ContextDir <String>
        The directory to put DbContext file in. Paths are relative to the project directory.
        
    -Context <String>
        The name of the DbContext to generate.
        
    -Schemas <String[]>
        The schemas of tables to generate entity types for.
        
    -Tables <String[]>
        The tables to generate entity types for.
        
    -DataAnnotations [<SwitchParameter>]
        Use attributes to configure the model (where possible). If omitted, only the fluent API is used.
        
    -UseDatabaseNames [<SwitchParameter>]
        Use table and column names directly from the database.
        
    -Force [<SwitchParameter>]
        Overwrite existing files.
        
    -Project <String>
        The project to use.
        
    -StartupProject <String>
        The startup project to use. Defaults to the solution's startup project.
```

## Design Considerations for a Projects DbContext

When Refactoring the DbContext that is autogenerated by EF Core, a few adjustments should be made. 

Firstly it is very common for a database to grow in size and therefore it only makes sense to separate the configuration of each table into its own classes of configuration as well as entity. This is in line with SOLID principles as well as separation of concern. Consider the following directory architecture

```
MyProject.Repository.csproj
	-- DbContexts [folder]
		-- Configurations [folder]
		MyProjectDbContext.cs
		BaseDbContext.cs
	-- Entities [folder]
	-- Repositories [folder]
```

This structure allows for a clear abstraction of the DbContext to allow for a cleaner, more scalable flow.

## How to Write A Configuration Class 

In order to illustrate this use case consider a table in SQL with the following signature:

```
User
__________________________
|Id(PK)	| Name	|Surname |
__________________________
|x		| xxxx	|xxxxxxx |
__________________________
```

This would map to the following Entity 

```c#
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Surname { get; set; }
}
```

A Configuration File for the `User` class would be as follows: 

```c#
public class UserConfiguration : IEntityTypeConfiguration<User>
{
     public void Configure(EntityTypeBuilder<User> entity)
        {
         	entity.Property(e => e.Id)
                .UseIdentityColumn()
                .ValueGeneratedOnAdd();
            entity.Property(e => e.Name)
                .IsRequired()
                .IsUnicode(false);
            entity.Property(e => e.Surname)
                .IsRequired()
                .IsUnicode(false);
        }
}
```

Which can be referenced in the `DbContext` as follows:

```c#
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.ApplyConfiguration(new UserConfiguration());
}
```

This enforces a cleaner architecture.

## Table Showing Additional Sections when Working with EF Core

| Section               | Description                                                  | Link                                    |
| --------------------- | ------------------------------------------------------------ | --------------------------------------- |
| Base DbContext Design | Show cases a useful methodology around simplifying core functionalities of EF Core and how to apply them using SOLID principles in Clean Architecture | [Find Here](./efcore/base-dbcontext.md) |
|                       |                                                              |                                         |
|                       |                                                              |                                         |

